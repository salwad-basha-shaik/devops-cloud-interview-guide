# ðŸŒŸ Trust Policy vs STS

## Question

**What is the difference between a Trust Policy and AWS STS (Security Token Service), and how are they related?**

---

## Short Explanation

This question checks your understanding of IAM role assumptions in AWS. Many confuse trust policies with permissions. The interviewer wants to know if you can explain who can assume a role (trust policy) and how temporary credentials are issued (STS).

---

## Answer

- **Trust Policy:** Defines who is allowed to assume a role (IAM users, roles, accounts, or AWS services).
- **STS (Security Token Service):** Provides temporary credentials (Access Key, Secret Key, Session Token) when a trusted principal assumes the role.
- **Relation:** STS enforces the trust policy. If the trust policy allows, STS issues temporary credentials.

---

## Detailed Explanation with Example

### ðŸ“Œ Trust Policy = Door Lock
- Attached to an IAM role.
- Decides who can enter (assume the role).
- Example: Allow EC2 service or an IAM user from another account to assume the role.

### ðŸ“Œ STS = Doorman
- Issues temporary access badges once the lock approves.
- Main API: `sts:AssumeRole`
- Temporary credentials expire (default 1h, up to 12h).

### ðŸ”— Relation
- Trust policy = Authorization check.
- STS = Execution service that issues temporary credentials.

---

## Real-World Example

**Scenario:**  
A developer in Account A needs to access an S3 bucket in Account B.

**Steps:**  
1. In Account B, create a role with:
   - **Trust Policy** â†’ allows Account Aâ€™s user to assume it.
   - **Permissions Policy** â†’ grants S3 access.
2. Developer in Account A runs:

```bash
aws sts assume-role 
â€“role-arn arn:aws:iam::AccountB-ID:role/S3AccessRole 
â€“role-session-name DevToS3
```

3. STS checks the trust policy. If allowed, it returns temporary credentials.
4. Developer uses these credentials to access S3 in Account B.

---

## Summary Table

| Aspect          | Trust Policy                       | STS (Security Token Service)        |
|-----------------|------------------------------------|-------------------------------------|
| Purpose         | Defines who can assume a role      | Issues temporary credentials        |
| Attached To     | IAM Role                           | AWS Service                        |
| Action          | sts:AssumeRole allowed or denied   | Executes sts:AssumeRole            |
| Scope           | Control over who can request access| Provides how access is granted      |
| Example         | EC2 can assume a role              | STS returns temp keys to EC2        |

---

## âœ… One line for interviews

A Trust Policy defines who is allowed to assume a role, while STS provides the temporary credentials once that trust is validated.

# More detailed answer below with an example

# Trust Policy vs AWS STS â€” Explained Clearly

## Question

**What is the difference between a trust policy and STS, and what is the relation between them? Am actually confused, so explain with an example.**

---

## ðŸ”¹ First: Trust Policy

- A **Trust Policy** is a JSON policy document attached to an IAM Role.
- It defines **who (which principal)** is allowed to assume that role.
- Example principals: AWS accounts, IAM users, IAM roles, or AWS services (like EC2, Lambda).

**ðŸ“Œ Example â€” Trust policy for a role that can be assumed by EC2:**

```json
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Principal": {
      "Service": "ec2.amazonaws.com"
    },
    "Action": "sts:AssumeRole"
  }
}
```

**ðŸ‘‰ Meaning:** Only EC2 instances can assume this role.

---

## ðŸ”¹ Second: AWS STS (Security Token Service)

- **STS** is an AWS service that issues **temporary credentials** (Access Key, Secret Key, Session Token).
- Itâ€™s used when a user, service, or application **assumes a role**.
- The main API here is `sts:AssumeRole`.

**ðŸ“Œ Example â€” Assume a role with STS:**

```bash
aws sts assume-role 
â€“role-arn arn:aws:iam::111122223333:role/S3ReadRole 
â€“role-session-name DemoSession
```
**ðŸ‘‰ Output:** Temporary security credentials valid for a short period (default 1 hour, can be up to 12 hours).

---

## ðŸ”— Relationship Between Trust Policy and STS

- The **Trust Policy** tells AWS **who is allowed** to call `sts:AssumeRole`.
- **STS** actually **performs the assume role** operation and returns temporary credentials.

**Think of it like this:**
- Trust Policy = Door Lock (decides who can enter).
- STS = Doorman (issues a temporary visitor badge once the lock approves).

---

## ðŸ”„ Example Scenario

**Situation:**  
You have a developer in Account A who needs to access an S3 bucket in Account B.

### **Step 1: In Account B**
Create a role `S3AccessRole` with this Trust Policy:

```json
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Principal": {
      "AWS": "arn:aws:iam::AccountA-ID:user/Developer"
    },
    "Action": "sts:AssumeRole"
  }
}
```
**ðŸ‘‰ This says:** Only the developer in Account A can assume this role.

### **Step 2: Permissions Policy for the Role**
Attach a permissions policy allowing S3 access:

```json
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Action": "s3:*",
    "Resource": "arn:aws:s3:::my-bucket/"
  }
}
```

**ðŸ‘‰ This defines what the role can do once assumed.**

### **Step 3: Developer in Account A**
Runs:

```bash
aws sts assume-role 
â€“role-arn arn:aws:iam::AccountB-ID:role/S3AccessRole 
â€“role-session-name DevToS3
```

STS checks the trust policy, and if allowed â†’ returns temporary credentials to access S3.

---

## âœ… In Short

- **Trust Policy:** Defines who can assume the role.
- **STS:** Issues temporary credentials when someone assumes the role.
- **Relation:** The trust policy is a precondition; STS enforces it and provides the credentials.

---
